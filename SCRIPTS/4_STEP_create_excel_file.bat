@echo off
chcp 65001 > nul
setlocal enabledelayedexpansion

echo ______________________________________________________________________________
echo          СОЗДАНИЕ ИТОГОВОГО EXCEL-ФАЙЛА
echo ______________________________________________________________________________
echo Обработка данных из папки 3raw_contents...
echo Результат будет сохранён в output.xlsx
echo ______________________________________________________________________________
echo.

:: Активируем Python-окружение
echo Активируем виртуальное окружение...
call ../venv/Scripts/activate

:: Запускаем скрипт генерации Excel
python ../4make_excel_files.py

:: Проверяем результат
if exist "../output.xlsx" (
    echo.
    echo ______________________________________________________________________________
    echo ✔ Файл output.xlsx успешно создан!
    echo Размер: %%~z output.xlsx байт
    echo ______________________________________________________________________________

    :: Предлагаем открыть файл
    echo.
    set /p open_file="Открыть файл output.xlsx сейчас? (Y - да / N - нет): "
    if /i "!open_file!" == "Y" (
        start "" "output.xlsx"
        echo Файл открыт в программе по умолчанию!
    )
) else (
    echo.
    echo ______________________________________________________________________________
    echo ❌ Ошибка! Файл output.xlsx не создан!
    echo Проверьте:
    echo 1. Наличие данных в папке 3raw_contents
    echo 2. Логи скрипта 4make_excel_files.py
    echo ______________________________________________________________________________
)

pause