@echo off
setlocal enabledelayedexpansion

echo ______________________________________________________________________________
echo          ВНИМАНИЕ: ЭТАП СБОРА СЫРЫХ ДАННЫХ ИЗ ФЕДРЕСУРСА
echo ______________________________________________________________________________
echo Сейчас будет заполняться папка **3raw_contents**.
echo Это МОЖЕТ ЗАНЯТЬ ЧАСЫ! Лучше запускать ночью или когда компьютер свободен.
echo ______________________________________________________________________________
echo.

:: Активируем Python-окружение
echo Активируем виртуальное окружение...
call ../venv/Scripts/activate

:: Выбор режима браузера (РЕКОМЕНДУЕТСЯ ВИДИМЫЙ!)
echo.
echo ################ ВАЖНЫЙ ВЫБОР: РЕЖИМ РАБОТЫ БРАУЗЕРА ################
echo [1] ★ РЕКОМЕНДУЕТСЯ ★ Видимый режим (--show) — браузер будет открыт.
echo     ✔ Надёжнее, стабильнее, меньше шансов на ошибки.
echo     ✖ Занимает экран, но можно свернуть.
echo.
echo [2] ❌ Скрытный режим (headless) — браузера не видно.
echo     ✔ Не мешает, но...
echo     ✖ Чаще зависает, может пропустить данные!
echo.
set /p browser_mode="Выберите режим (1 или 2, лучше 1): "

if "!browser_mode!" == "2" (
    set show_param=
    echo ❗ ВЫБРАН СКРЫТНЫЙ РЕЖИМ! МОГУТ БЫТЬ ПРОБЛЕМЫ!
    echo Совет: если скрипт упадёт, перезапустите его с видимым браузером.
) else (
    set show_param=--show
    echo ✔ Выбран ВИДИМЫЙ РЕЖИМ. Браузер будет отображаться (можно свернуть).
)

:: Пересоздание папки 3raw_contents (если нужно)
echo.
echo ______________________________________________________________________________
echo Если папка **3raw_contents** уже существует:
echo [1] Использовать существующие данные (продолжить с места остановки).
echo [2] УДАЛИТЬ и пересоздать папку заново (если прошлые данные битые).
echo ______________________________________________________________________________
echo.
set /p force_recreate="Ваш выбор (1 или 2): "

if "!force_recreate!" == "2" (
    set force_param=--force-recreate
    echo ❗ ВНИМАНИЕ: Папка **3raw_contents** будет УДАЛЕНА и создана заново!
) else (
    set force_param=
    echo ✔ Используем существующие данные (если есть).
)

:: Запуск с предупреждением
echo.
echo ______________________________________________________________________________
echo ⚠ ЗАПУСК ПАРСИНГА! ⚠
echo - Не закрывайте это окно.
echo - Если выбран видимый режим, НЕ ЗАКРЫВАЙТЕ БРАУЗЕР!
echo - Процесс может занять ЧАСЫ. Лучше оставить ПК включённым.
echo ______________________________________________________________________________
echo.
pause

:: Запускаем скрипт
echo Запускаем 3prepare_raw_contents.py...
python ../3prepare_raw_contents.py !show_param! !force_param!

:: Результат
if !errorlevel! equ 0 (
    echo.
    echo ______________________________________________________________________________
    echo ★★★ УСПЕХ! ★★★
    echo Папка **3raw_contents** готова! Можно переходить к следующему этапу.
    echo ______________________________________________________________________________
) else (
    echo.
    echo ______________________________________________________________________________
    echo ❌❌❌ ОШИБКА! ❌❌❌
    echo Код ошибки: !errorlevel!
    echo Возможные причины:
    echo - Проблемы с интернетом
    echo - Браузер завис (особенно в скрытом режиме)
    echo - Закончилось место на диске
    echo Совет: попробуйте запустить снова с видимым браузером (режим 1).
    echo ______________________________________________________________________________
)

pause